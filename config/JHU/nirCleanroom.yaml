geometry:

  n3:
    # Affine/Projective transforms have awful residual structures, > 30 pix
    # So switch to more opaque polynomial pairs.
    #
    transformClass: skimage.transform.ProjectiveTransform
    transformCoeffs:
      - [[ 7.28221767e-03,  1.96742380e-04, -3.36870215e+02],
         [ 1.28388579e-05,  7.08578809e-03, -5.67919079e+02],
          [ 4.12862303e-10,  9.95802613e-08,  9.62844698e-01]]
  n1:
    transformClass: skimage.transform.ProjectiveTransform
    transformCoeffs:
      - [[ 7.28221767e-03,  1.96742380e-04, -3.36870215e+02],
         [ 1.28388579e-05,  7.08578809e-03, -5.67919079e+02],
          [ 4.12862303e-10,  9.95802613e-08,  9.62844698e-01]]
    #transformClass: IDG
    #transformCoeffs: [ 2.09416073e+03, 2.02855279e+03, 3.20258452e+05, 3.72593560e+05,
    #                  -4.01344113e+03,-4.23322172e+03, 2.73328937e-01]

# Aim for 7k ADU in 3-reads
leds:
  wave: [1300, 1200, 1085, 1070, 1050, 970, 930]
  dutyCycle: [15.0, 5.0, 30, 33, 15, 15, 13]
  focusOffset: [4.0, 0, 0, 0, 0, 0, -10.0]
  position: [112, 432, 1396, 1639, 1822, 3250, 3996]

#
mono:
  use: [True, True, True, True, True]
  wave: [1260, 1180, 1100, 1020, 940]
  dutyCycle: [100, 100, 100, 100, 100]
  positionMM: [-29.450, -14.135, 0.721, 15.290, 29.700]

rowsMM:  [-30.03, -21.0, -14.99, 0, 14.99, 21.00, 30.03]

# Per detector tweaks to positions, with a dictionary of (wave, rows) -> (xoff, yoff)
# But we have to save the keys as strings. Python encodes tuples with spaces
# after the commas: make sure we match that here. Both wave and row should be ints.
#
nudges:
  n3:
    (1260, 45): [10, -8]
    (1260, 648): [-5, -5]
    (1260, 1048): [5, -5]
    (1260, 3047): [10,-10]
    (1260, 3448): [-5, 10]
    (1260, 4050): [4, -33]
  
    (1180, 45): [10, -5]
    (1180, 4050): [5, -25]

    (1100, 4050): [13, -25]

    (1020, 45): [-20, 0]
    (1020, 1048): [-5, 5]
    (1020, 4050): [-12, -15]

    (940, 45): [0, -5]
    (940, 648): [-8, 0]
    (940, 1048): [0, -5]
    (940, 3047): [-5, 0]
    (940, 3448): [20, 5]
    (940, 4050): [0, -34]

    (1260, 3283): [10, 5]
    (1260, 2666): [10, 0]

    (1180, 3900): [-5,-10]
    (1180, 2666): [-5, -5]
    (1180, 1433): [10, 0]
    (1180, 200): [0, -10]

    (1100, 3900): [0, 10]
    (1100, 3283): [0, 10]
    (1100, 1433): [0, -10]

    (1020, 3900): [5, -10]
    (1020, 3263): [5, 5]
    (1020, 2666): [-10, 0]
    (1020, 1433): [0, 10]
    (1020, 816): [0, 10]
    (1020, 200): [5, 5]

    (940, 3900): [0, -5]
    (940, 816): [-10, 0]
    (940, 200): [0, -10]
  
  n1:
    (1260, 1433): [5, 0]

    (1180, 2050): [5, 5]
    (1180, 1433): [-5, -5]
    (1180, 200): [-5, -5]

    (1100, 3900): [8, 3]
    (1100, 2666): [5, 0]

    (1020, 3283): [-5, -5]
    (1020, 2050): [5, -5]
    (1020, 1433): [5, -5]
    (1020, 816): [-5, 0]

    (940, 3283): [-8, 0]
    (940, 2050): [5, 5]
    (940, 200): [-5, 0]

    (1260, 4050): [5, -15]

    (1180, 4050): [5, -5]
    (1180, 2048): [-5, 5]
    (1180, 648): [5, 5]
    (1180, 45): [5, 5]

    (1100, 3448): [-5, -5]
    (1100, 3047): [5, 5]
    (1100, 1048): [10, 5]
    (1100, 45): [5, 0]

    (1020, 4050): [-5, 5]
    (1020, 3047): [0, -5]
    (1020, 2048): [0, -5]
    (1020, 1048): [-5, -5]
    (1020, 648): [5, 0]
    (1020, 45): [0, 10]

    (940, 2048): [5, 5]
    (940, 45): [0, 15]
pix0:
  n1:
    (1260, 4050): [95.0, 4055.0]
    (1260, 3448): [95.0, 3444.0]
    (1260, 3047): [96.0, 3034.0]
    (1260, 2048): [93.0, 2025.0]
    (1260, 1048): [83.0, 1029.0]
    (1260, 648): [76.0, 631.0]
    (1260, 45): [64.0, 28.0]

    (1180, 4050): [1126.0, 4050.0]
    (1180, 3448): [1122.0, 3435.0]
    (1180, 3047): [1121.0, 3027.0]
    (1180, 2048): [1112.0, 2027.0]
    (1180, 1048): [1110.0, 1028.0]
    (1180, 648): [1112.0, 638.0]
    (1180, 45): [1105.0, 40.0]

    (1100, 4050): [2110.0, 4049.0]
    (1100, 3448): [2104.0, 3424.0]
    (1100, 3047): [2112.0, 3026.0]
    (1100, 2048): [2103.0, 2018.0]
    (1100, 1048): [2109.0, 1031.0]
    (1100, 648): [2097.0, 631.0]
    (1100, 45): [2100.0, 35.0]

    (1020, 4050): [3075.0, 4052.0]
    (1020, 3448): [3076.0, 3426.0]
    (1020, 3047): [3074.0, 3013.0]
    (1020, 2048): [3070.0, 2009.0]
    (1020, 1048): [3063.0, 1016.0]
    (1020, 648): [3073.0, 626.0]
    (1020, 45): [3070.0, 38.0]

    (940, 4050): [4050.0, 4053.0]
    (940, 3448): [4042.0, 3428.0]
    (940, 3047): [4038.0, 3017.0]
    (940, 2048): [4039.0, 2015.0]
    (940, 1048): [4035.0, 1014.0]
    (940, 648): [4038.0, 617.0]
    (940, 45): [4046.0, 30.0]

    (1260, 3900): [94.0, 3913.0]
    (1260, 3283): [98.0, 3275.0]
    (1260, 2666): [97.0, 2647.0]
    (1260, 2050): [95.0, 2027.0]
    (1260, 1433): [94.0, 1412.0]
    (1260, 816): [82.0, 798.0]
    (1260, 200): [69.0, 184.0]

    (1180, 3900): [1124.0, 3899.0]
    (1180, 3283): [1124.0, 3266.0]
    (1180, 2666): [1122.0, 2642.0]
    (1180, 2050): [1124.0, 2029.0]
    (1180, 1433): [1109.0, 1405.0]
    (1180, 816): [1109.0, 800.0]
    (1180, 200): [1099.0, 184.0]

    (1100, 3900): [2120.0, 3896.0]
    (1100, 3283): [2110.0, 3261.0]
    (1100, 2666): [2112.0, 2637.0]
    (1100, 2050): [2105.0, 2020.0]
    (1100, 1433): [2102.0, 1407.0]
    (1100, 816): [2099.0, 797.0]
    (1100, 200): [2097.0, 188.0]

    (1020, 3900): [3081.0, 3891.0]
    (1020, 3283): [3072.0, 3253.0]
    (1020, 2666): [3074.0, 2634.0]
    (1020, 2050): [3077.0, 2012.0]
    (1020, 1433): [3075.0, 1398.0]
    (1020, 816): [3064.0, 793.0]
    (1020, 200): [3071.0, 183.0]

    (940, 3900): [4050.0, 3896.0]
    (940, 3283): [4035.0, 3259.0]
    (940, 2666): [4038.0, 2632.0]
    (940, 2050): [4041.0, 2017.0]
    (940, 1433): [4037.0, 1397.0]
    (940, 816): [4039.0, 785.0]
    (940, 200): [4041.0, 170.0]

  n3:
    (1260, 45): [73.0, 42.0]
    (1260, 648): [68.0, 646.0]
    (1260, 1048): [83.0, 1044.0]
    (1260, 2048): [85.0, 2044.0]
    (1260, 3047): [94.0, 3040.0]
    (1260, 3448): [77.0, 3471.0]
    (1260, 4050): [79.0, 4052.0]

    (1180, 45): [1107.0, 56.0]
    (1180, 648): [1100.0, 657.0]
    (1180, 1048): [1103.0, 1052.0]
    (1180, 2048): [1106.0, 2045.0]
    (1180, 3047): [1107.0, 3047.0]
    (1180, 3448): [1106.0, 3455.0]
    (1180, 4050): [1110.0, 4050.0]

    (1100, 45): [2090.0, 63.0]
    (1100, 648): [2090.0, 657.0]
    (1100, 1048): [2090.0, 1053.0]
    (1100, 2048): [2091.0, 2044.0]
    (1100, 3047): [2091.0, 3046.0]
    (1100, 3448): [2091.0, 3451.0]
    (1100, 4050): [2104.0, 4045.0]

    (1020, 45): [3044.0, 61.0]
    (1020, 648): [3060.0, 657.0]
    (1020, 1048): [3053.0, 1056.0]
    (1020, 2048): [3057.0, 2044.0]
    (1020, 3047): [3057.0, 3047.0]
    (1020, 3448): [3057.0, 3453.0]
    (1020, 4050): [3046.0, 4058.0]

    (940, 45): [4039.0, 45.0]
    (940, 648): [4021.0, 651.0]
    (940, 1048): [4025.0, 1043.0]
    (940, 2048): [4020.0, 2043.0]
    (940, 3047): [4016.0, 3049.0]
    (940, 3448): [4043.0, 3464.0]
    (940, 4050): [4028.0, 4047.0]

    (1260, 3900): [74.0, 3929.0]
    (1260, 3283): [91.0, 3298.0]
    (1260, 2666): [93.0, 2664.0]
    (1260, 2050): [83.0, 2045.0]
    (1260, 1433): [81.0, 1430.0]
    (1260, 816): [75.0, 817.0]
    (1260, 200): [66.0, 202.0]
    (1180, 3900): [1097.0, 3909.0]
    (1180, 3283): [1105.0, 3287.0]
    (1180, 2666): [1101.0, 2657.0]
    (1180, 2050): [1105.0, 2045.0]
    (1180, 1433): [1114.0, 1432.0]
    (1180, 816): [1101.0, 822.0]
    (1180, 200): [1098.0, 202.0]
    (1100, 3900): [2089.0, 3927.0]
    (1100, 3283): [2089.0, 3295.0]
    (1100, 2666): [2090.0, 2662.0]
    (1100, 2050): [2091.0, 2045.0]
    (1100, 1433): [2091.0, 1423.0]
    (1100, 816): [2090.0, 823.0]
    (1100, 200): [2090.0, 215.0]
    (1020, 3900): [3063.0, 3908.0]
    (1020, 3283): [3057.0, 3286.0]
    (1020, 2666): [3047.0, 2662.0]
    (1020, 2050): [3057.0, 2045.0]
    (1020, 1433): [3057.0, 1442.0]
    (1020, 816): [3059.0, 832.0]
    (1020, 200): [3068.0, 217.0]
    (940, 3900): [4026.0, 3922.0]
    (940, 3283): [4023.0, 3290.0]
    (940, 2666): [4021.0, 2664.0]
    (940, 2050): [4021.0, 2045.0]
    (940, 1433): [4024.0, 1429.0]
    (940, 816): [4019.0, 817.0]
    (940, 200): [4038.0, 193.0]
