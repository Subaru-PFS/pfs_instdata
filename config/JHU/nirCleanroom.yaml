geometry:
  n4:
    transformClass: skimage.transform.ProjectiveTransform
    transformCoeffs:
      - [[ 7.53277488e-03,  1.81635849e-04, -3.27905203e+02],
         [ 1.20480711e-05,  7.33957478e-03, -6.36947591e+02],
         [ 8.09586642e-10,  9.16709273e-08,  1.00000000e+00]]
  n3:
    # Affine/Projective transforms have awful residual structures, > 30 pix
    # So switch to more opaque polynomial pairs.
    #
    transformClass: skimage.transform.ProjectiveTransform
    transformCoeffs:
      - [[ 7.28221767e-03,  1.96742380e-04, -3.36870215e+02],
         [ 1.28388579e-05,  7.08578809e-03, -5.67919079e+02],
          [ 4.12862303e-10,  9.95802613e-08,  9.62844698e-01]]
  n2:
    transformClass: skimage.transform.ProjectiveTransform
    transformCoeffs:
      - [[ 7.54518845e-03,  1.74966985e-04, -3.34808883e+02],
      [ 2.17443913e-05,  7.35416808e-03, -5.93169954e+02],
      [ 3.61217191e-11,  9.56019340e-08,  1.00000000e+00]]
      #- [[ 7.55952144e-03,  1.91157374e-04, -3.52357926e+02],
      #   [ 1.28008460e-05,  7.35900871e-03, -6.09004159e+02],
      #   [ 2.09891567e-09,  9.52612296e-08,  1.00000000e+00]]
    #transformClass: IDG
    #transformCoeffs: [ 2.07688081e+03,  2.03338898e+03,
    #                   3.21965176e+05,  3.73820119e+05,
    #                  -4.01486929e+03, -4.22758001e+03,
    #                  -4.11658331e-02, -9.06545014e-04]
  n1:
    transformClass: skimage.transform.ProjectiveTransform
    transformCoeffs:
      - [[ 7.54960896e-03,  2.06739515e-04, -3.56307997e+02],
         [-6.26415659e-06,  7.35221465e-03, -6.40880219e+02],
         [ 4.07398065e-10,  9.44746578e-08,  1.00000000e+00]]
      #- [[ 7.52580301e-03,  2.07470863e-04, -3.48843217e+02],
      #   [-1.07998844e-05,  7.32719207e-03, -3.47387742e+02],
      #   [ 7.05332867e-10,  9.46257812e-08,  1.00000000e+00]]
      #- [[ 7.52580301e-03,  2.07470863e-04, -3.48843217e+02],
      #   [-1.07998844e-05,  7.32719207e-03, -3.47387742e+02],
      #   [ 7.05332867e-10,  9.46257812e-08,  1.00000000e+00]]
      #- [[ 7.50130969e-03,  1.94345391e-04, -3.39610798e+02],
      #   [-9.98408020e-06,  7.30889376e-03, -3.49054279e+02],
      #   [ 1.13155089e-09,  8.89147992e-08,  1.00000000e+00]]
      #- [[ 7.28221767e-03,  1.96742380e-04, -3.36870215e+02],
      #   [ 1.28388579e-05,  7.08578809e-03, -5.67919079e+02],
      #    [ 4.12862303e-10,  9.95802613e-08,  9.62844698e-01]]
    #transformClass: IDG
    #transformCoeffs: [ 2.09416073e+03, 2.02855279e+03, 3.20258452e+05, 3.72593560e+05,
    #                  -4.01344113e+03,-4.23322172e+03, 2.73328937e-01]

# Aim for 7k ADU in 3-reads
leds:
  wave: [1300, 1200, 1085, 1070, 1050, 970, 930]
  dutyCycle: [15.0, 5.0, 30, 33, 15, 15, 13]
  focusOffset: [4.0, 0, 0, 0, 0, 0, -10.0]
  position: [112, 432, 1396, 1639, 1822, 3250, 3996]

#
mono:
  use: [True, True, True, True, True]
  wave: [1260, 1180, 1100, 1020, 940]
  dutyCycle: [100, 100, 100, 100, 100]
  positionMM: [-29.450, -14.135, 0.721, 15.290, 29.700]

rowsMM:  [-30.03, -21.0, -14.99, 0, 14.99, 21.00, 30.03]

# Per detector tweaks to positions, with a dictionary of (wave, rows) -> (xoff, yoff)
# But we have to save the keys as strings. Python encodes tuples with spaces
# after the commas: make sure we match that here. Both wave and row should be ints.
#
nudges:
  n4:
    (1260, 4050): [-10, -25]
    (1260, 1048): [5, 5]
    (1260, 45): [6, 20]

    (1180, 4050): [9, -12]
    (1180, 2048): [5, -5]
    (1180, 1048): [0, -8]
    (1180, 648): [5, -3]
    (1180, 45): [-3, 2]

    (1100, 4050): [-6, -12]

    (1020, 4050): [0, -12]
    (1020, 1048): [0, 5]
    (1020, 45): [6, -5]

    (940, 4050): [4, -14]
    (940, 2048): [-5, 0]
    (940, 648): [0, -5]

  n2:
    (1260, 2048): [0, 8]

    (1180, 4050): [4, -4]
    (1180, 3448): [10, 0]

    (1100, 4050): [10, -12]
    (1100, 3448): [7, 0]
    (1100, 2048): [6, 0]

    (1020, 4050): [-18, 0]
    (1020, 3448): [7, 4]
    (1020, 1048): [-3, -4]
    (1020, 45): [-16, -3]

    (940, 4050): [0, -8]
    (940, 3448): [-4, -7]
    (940, 3047): [-4, -5]
    (940, 1048): [0, -5]
    (940, 648): [3, 5]
    (940, 45): [-5, 0]


  n3:
    (1260, 45): [10, -8]
    (1260, 648): [-5, -5]
    (1260, 1048): [5, -5]
    (1260, 3047): [10,-10]
    (1260, 3448): [-5, 10]
    (1260, 4050): [4, -33]
  
    (1180, 45): [10, -5]
    (1180, 4050): [5, -25]

    (1100, 4050): [13, -25]

    (1020, 45): [-20, 0]
    (1020, 1048): [-5, 5]
    (1020, 4050): [-12, -15]

    (940, 45): [0, -5]
    (940, 648): [-8, 0]
    (940, 1048): [0, -5]
    (940, 3047): [-5, 0]
    (940, 3448): [20, 5]
    (940, 4050): [0, -34]

    (1260, 3283): [10, 5]
    (1260, 2666): [10, 0]

    (1180, 3900): [-5,-10]
    (1180, 2666): [-5, -5]
    (1180, 1433): [10, 0]
    (1180, 200): [0, -10]

    (1100, 3900): [0, 10]
    (1100, 3283): [0, 10]
    (1100, 1433): [0, -10]

    (1020, 3900): [5, -10]
    (1020, 3263): [5, 5]
    (1020, 2666): [-10, 0]
    (1020, 1433): [0, 10]
    (1020, 816): [0, 10]
    (1020, 200): [5, 5]

    (940, 3900): [0, -5]
    (940, 816): [-10, 0]
    (940, 200): [0, -10]

  n1:
    (1260, 4050): [5, -15]
    (1260, 648): [-10, 0]
    (1260, 45): [0, 10]

    (1180, 4050): [10, -10]
    (1180, 2048): [5, 0]
    (1180, 1048): [0, 10]
    (1180, 45): [0, -5]

    (1100, 3448): [-5, -5]
    (1100, 3047]): [5, -5]

    (1020, 3448): [-10, 0]
    (1020, 1048): [-10, 10]

    (940, 4050): [5, -10]
    (940, 3448): [-5, 5]
    (940, 3047): [5, 10]
    (940, 2048): [-10, 0]
    (940, 1048): [0, 10]
    (940, 648): [0, 15]

pix0:
  n4:
    (1260, 4050): [86.0, 4069.0]
    (1260, 3448): [91.0, 3450.0]
    (1260, 3047): [92.0, 3043.0]
    (1260, 2048): [89.0, 2042.0]
    (1260, 1048): [80.0, 1047.0]
    (1260, 648): [73.0, 649.0]
    (1260, 45): [61.0, 45.0]

    (1180, 4050): [1112.0, 4059.0]
    (1180, 3448): [1113.0, 3445.0]
    (1180, 3047): [1113.0, 3040.0]
    (1180, 2048): [1112.0, 2042.0]
    (1180, 1048): [1107.0, 1052.0]
    (1180, 648): [1104.5, 656.0]
    (1180, 45): [1099.0, 57.5]

    (1100, 4050): [2096.0, 4054.0]
    (1100, 3448): [2096.0, 3442.0]
    (1100, 3047): [2097.0, 3038.0]
    (1100, 2048): [2097.0, 2041.0]
    (1100, 1048): [2096.0, 1051.0]
    (1100, 648): [2096.0, 656.0]
    (1100, 45): [2096.0, 59.0]

    (1020, 4050): [3061.0, 4058.0]
    (1020, 3448): [3060.0, 3444.0]
    (1020, 3047): [3061.0, 3040.0]
    (1020, 2048): [3063.0, 2042.0]
    (1020, 1048): [3067.0, 1051.0]
    (1020, 648): [3069.0, 655.0]
    (1020, 45): [3074.0, 56.5]

    (940, 4050): [4027.0, 4068.0]
    (940, 3448): [4023.0, 3449.0]
    (940, 3047): [4023.0, 3043.0]
    (940, 2048): [4027.0, 2042.0]
    (940, 1048): [4035.0, 1047.0]
    (940, 648): [4041.0, 649.0]
    (940, 45): [4052.5, 46.5]

  n2:
    (1260, 4050): [85.0, 4070.0]
    (1260, 3448): [91.0, 3449.0]
    (1260, 3047): [93.0, 3042.0]
    (1260, 2048): [91.0, 2039.0]
    (1260, 1048): [82.0, 1044.0]
    (1260, 648): [77.0, 647.0]
    (1260, 45): [66.0, 45.0]

    (1180, 4050): [1112.0, 4061.0]
    (1180, 3448): [1114.0, 3445.0]
    (1180, 3047): [1114.0, 3039.0]
    (1180, 2048): [1113.0, 2040.0]
    (1180, 1048): [1108.0, 1049.0]
    (1180, 648): [1106.0, 654.0]
    (1180, 45): [1101.0, 56.0]

    (1100, 4050): [2097.0, 4058.0]
    (1100, 3448): [2098.0, 3444.0]
    (1100, 3047): [2098.0, 3039.0]
    (1100, 2048): [2098.0, 2041.0]
    (1100, 1048): [2097.0, 1052.0]
    (1100, 648): [2097.0, 657.0]
    (1100, 45): [2096.0, 60.0]

    (1020, 4050): [3063.0, 4062.0]
    (1020, 3448): [3062.0, 3446.0]
    (1020, 3047): [3062.0, 3040.0]
    (1020, 2048): [3063.0, 2042.0]
    (1020, 1048): [3066.0, 1051.0]
    (1020, 648): [3068.0, 656.0]
    (1020, 45): [3072.0, 58.0]

    (940, 4050): [4031.0, 4071.0]
    (940, 3448): [4026.0, 3451.0]
    (940, 3047): [4025.0, 3044.0]
    (940, 2048): [4026.0, 2042.0]
    (940, 1048): [4033.0, 1048.0]
    (940, 648): [4038.0, 650.0]
    (940, 45): [4049.0, 49.0]

  n1:
    (1260, 4050): [86.0, 4070.0]
    (1260, 3448): [91.0, 3449.0]
    (1260, 3047): [93.0, 3042.0]
    (1260, 2048): [91.0, 2039.0]
    (1260, 1048): [82.0, 1045.0]
    (1260, 648): [77.0, 647.0]
    (1260, 45): [65.5, 45.0]

    (1180, 4050): [1111.0, 4060.0]
    (1180, 3448): [1113.0, 3444.0]
    (1180, 3047): [1114.0, 3039.0]
    (1180, 2048): [1112.0, 2040.0]
    (1180, 1048): [1107.0, 1049.0]
    (1180, 648): [1105.0, 653.0]
    (1180, 45): [1101.0, 55.0]

    (1100, 4050): [2096.0, 4057.2]
    (1100, 3448): [2097.0, 3442.0]
    (1100, 3047): [2097.0, 3037.0]
    (1100, 2048): [2097.5, 2039.0]
    (1100, 1048): [2096.0, 1049.0]
    (1100, 648): [2096.0, 655.0]
    (1100, 45): [2096.5, 58.0]

    (1020, 4050): [3062.0, 4059.0]
    (1020, 3448): [3061.0, 3443.0]
    (1020, 3047): [3061.0, 3038.0]
    (1020, 2048): [3062.0, 2040.0]
    (1020, 1048): [3065.0, 1049.0]
    (1020, 648): [3067.0, 654.0]
    (1020, 45): [3071.8, 56.0]

    (940, 4050): [4028.0, 4068.8]
    (940, 3448): [4024.0, 3449.0]
    (940, 3047): [4023.0, 3041.0]
    (940, 2048): [4025.0, 2038.8]
    (940, 1048): [4032.0, 1044.8]
    (940, 648): [4037.0, 646.8]
    (940, 45): [4049.2, 45.0]

  n3:
    (1260, 45): [73.0, 42.0]
    (1260, 648): [68.0, 646.0]
    (1260, 1048): [83.0, 1044.0]
    (1260, 2048): [85.0, 2044.0]
    (1260, 3047): [94.0, 3040.0]
    (1260, 3448): [77.0, 3471.0]
    (1260, 4050): [79.0, 4052.0]

    (1180, 45): [1107.0, 56.0]
    (1180, 648): [1100.0, 657.0]
    (1180, 1048): [1103.0, 1052.0]
    (1180, 2048): [1106.0, 2045.0]
    (1180, 3047): [1107.0, 3047.0]
    (1180, 3448): [1106.0, 3455.0]
    (1180, 4050): [1110.0, 4050.0]

    (1100, 45): [2090.0, 63.0]
    (1100, 648): [2090.0, 657.0]
    (1100, 1048): [2090.0, 1053.0]
    (1100, 2048): [2091.0, 2044.0]
    (1100, 3047): [2091.0, 3046.0]
    (1100, 3448): [2091.0, 3451.0]
    (1100, 4050): [2104.0, 4045.0]

    (1020, 45): [3044.0, 61.0]
    (1020, 648): [3060.0, 657.0]
    (1020, 1048): [3053.0, 1056.0]
    (1020, 2048): [3057.0, 2044.0]
    (1020, 3047): [3057.0, 3047.0]
    (1020, 3448): [3057.0, 3453.0]
    (1020, 4050): [3046.0, 4058.0]

    (940, 45): [4039.0, 45.0]
    (940, 648): [4021.0, 651.0]
    (940, 1048): [4025.0, 1043.0]
    (940, 2048): [4020.0, 2043.0]
    (940, 3047): [4016.0, 3049.0]
    (940, 3448): [4043.0, 3464.0]
    (940, 4050): [4028.0, 4047.0]

    (1260, 3900): [74.0, 3929.0]
    (1260, 3283): [91.0, 3298.0]
    (1260, 2666): [93.0, 2664.0]
    (1260, 2050): [83.0, 2045.0]
    (1260, 1433): [81.0, 1430.0]
    (1260, 816): [75.0, 817.0]
    (1260, 200): [66.0, 202.0]
    (1180, 3900): [1097.0, 3909.0]
    (1180, 3283): [1105.0, 3287.0]
    (1180, 2666): [1101.0, 2657.0]
    (1180, 2050): [1105.0, 2045.0]
    (1180, 1433): [1114.0, 1432.0]
    (1180, 816): [1101.0, 822.0]
    (1180, 200): [1098.0, 202.0]
    (1100, 3900): [2089.0, 3927.0]
    (1100, 3283): [2089.0, 3295.0]
    (1100, 2666): [2090.0, 2662.0]
    (1100, 2050): [2091.0, 2045.0]
    (1100, 1433): [2091.0, 1423.0]
    (1100, 816): [2090.0, 823.0]
    (1100, 200): [2090.0, 215.0]
    (1020, 3900): [3063.0, 3908.0]
    (1020, 3283): [3057.0, 3286.0]
    (1020, 2666): [3047.0, 2662.0]
    (1020, 2050): [3057.0, 2045.0]
    (1020, 1433): [3057.0, 1442.0]
    (1020, 816): [3059.0, 832.0]
    (1020, 200): [3068.0, 217.0]
    (940, 3900): [4026.0, 3922.0]
    (940, 3283): [4023.0, 3290.0]
    (940, 2666): [4021.0, 2664.0]
    (940, 2050): [4021.0, 2045.0]
    (940, 1433): [4024.0, 1429.0]
    (940, 816): [4019.0, 817.0]
    (940, 200): [4038.0, 193.0]
